#include <main.h>
int8 maled7[10] = {0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90};
int16 count_isr=0;
int16 count=0;
void hienSoTangDan(int16 sotang)
{  
         output_low(PIN_A4);
         output_high(PIN_E0);
         output_high(PIN_E1);
         output_high(PIN_E2);
         output_d(maled7[sotang / 1000]);
         delay_ms(5);
         output_low(PIN_E0);
         output_high(PIN_A4);
         output_high(PIN_E1);
         output_high(PIN_E2);
         output_d(maled7[(sotang % 1000) / 100]);
         delay_ms(5);
         output_low(PIN_E1);
         output_high(PIN_E0);
         output_high(PIN_A4);
         output_high(PIN_E2);
         output_d(maled7[((sotang % 1000) % 100) / 10]);
         delay_ms(5);
         output_low(PIN_E2);
         output_high(PIN_E0);
         output_high(PIN_E1);
         output_high(PIN_A4);
         output_d(maled7[((sotang % 1000) % 100) % 10]);
         delay_ms(5);
}
void main()
{
   setup_timer_0(T0_INTERNAL | T0_DIV_32); // thiet lap timer 0 là hoac cua 2 cai sau
                                           // clock nôi: T0_INTERNAL (dòng 152) -> xung là 20M/4 = 5MHz = 5000KHz
                                           // chê dô chia 32 tuc timer 0 dem tù 0 -> 256, moi 1 lan tang 1 don vi mat khoang thoi gian là 32/5000(ms)
   set_timer0(61);                         // cài dat timer 0 dém tu 61 -> 256 -> timer 0 se dém trong khoang thoi gian 32/5000(ms) * (256 - 61) = 1,248 ms 
   enable_interrupts(INT_TIMER0);          // enable ngat tràn timer 0
   enable_interrupts(GLOBAL);              // enable ngat toan cuc
   while(TRUE)
   {
      //TODO: User Code
      hienSoTangDan(count);                // tang len 1 don vi sau 0,1248 s
   }
}
#INT_TIMER0
void timer0_isr(void)                      // ham nay tu dong dc goi khi timer 0 xay ra tràn (tuc su kien ngat)
{
   set_timer0(61);                         // vì timer 0 se tiêp tuc dem sau khi su kien ngat xay ra nên dê timer 0 dém trong khoang thoi gian nhu cu (1,248 ms), can cau lenh dòng này de cai dat timer 0 dem tu 61 -> 256
   count_isr++;
   if(count_isr == 100)                    // khi timer 0 dem tràn 100 lân (túc sau 100 * 1,248ms = 0,1248s), sô duoc hiên thi se tang 1 don vi 
   {
      count++;
      count_isr = 0;
   }
   if(count == 10000)
   count = 0;
}
